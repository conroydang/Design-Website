if (self.CavalryLogger) { CavalryLogger.start_js(["rJk2y"]); }

__d("VideoPlayerOzImplementationEnginePartsImplFunction",["CometThrottle","OzCustomParsers","OzCustomRepresentationParsers","OzDashPrefetchCache","OzVideoLiveTraceNetworkRequestStreamHandler","TimeRanges","VideoPlayerConnectionQuality","VideoPlayerOzImplementationEnginePartsImplUtils","getOzPlaybackRestrictions","gkx","oz-player/networks/OzBandwidthEstimator","oz-player/parsers/OzPredictedSegmentTimelineParser","unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";var g=b("OzCustomParsers").createOzCustomParser,h=b("OzCustomRepresentationParsers").createOzCustomRepresentationParsers,i=(c=b("VideoPlayerOzImplementationEnginePartsImplUtils")).calculateInitialPlaybackPositionForDynamicMpd,j=c.calculateLiveheadFallBehindBlockMargin,k=c.calculateLiveheadFallBehindBlockThreshold,l=c.checkShouldIncludeCredentials,m=c.createOzBufferingDetector,n=c.createOzDrmModules,o=c.createOzPerfLoggerProviders;function a(a){var c=a.OzPlayerClass,d=a.callChain,e=a.destroyOzPlayerPartsRef,f=a.engineDebugAPI,p=a.getCaptionsInfo,q=a.getEngineExtrasAPI,r=a.getOzQuickStarter,s=a.getVideoLiveTrace,t=a.handleCaptionsInfoChange,u=a.handleFatalImplementationError,v=a.initialProps,w=a.machine,x=a.ozBufferingDetectorRef,y=a.ozPlayerRef,z=a.playerVersion,A=a.resolvedVideoInfo,B=a.videoElement;a=a.videoElementAPI;var C={current:null};e.current=function(a){var c=x.current;c&&(x.current=null,c.destroy());c=y.current;c&&(f&&f.handleOzPlayerChanged(null),y.current=null,c.destroy(b("gkx")("1435909")?[].concat(a,["destroyOzPlayerParts"]).join(":"):null));c=C.current;c&&(C.current=null,c())};e=A.VideoPlayerShakaPerformanceLoggerClass;var D=A.experimentationConfig,E=A.graphQLVideoDRMInfo,F=A.manifestUrl,G=A.manifestXmlStringResolved,H=A.minQualityPreference;A=A.videoFBID;var I=q();if(I==null)throw b("unrecoverableViolation")("engineExtrasAPI was not created before OzPlayer creation","comet_video_player");r=r();var J=Boolean(v.loggingMetaData.coreVideoPlayerMetaData.isLiveStreaming),K=function(a){a=q();return!a?null:a.getEstimatedBandwidth()},L=function(){D.setContext("connection_quality",b("VideoPlayerConnectionQuality").evaluate(function(){return K(J)}))},M=function(){var a=D.getNumber("connection_quality_context_throttle_frequency",0);if(a===0)return null;var c=b("CometThrottle")(L,a),d=b("oz-player/networks/OzBandwidthEstimator").addListener("bandwidth_sampled",c);return function(){d.remove(),c.cancel()}};C.current=M();M=v.loggingMetaData.dimensions;E=n({graphQLVideoDRMInfo:E,videoFBID:A});var N=E.drmManagerModule;E=E.drmProviders;z=o({VideoPlayerShakaPerformanceLoggerClass:e,getBandwidthEstimate:K,playbackIsLiveStreaming:J,playerInstanceCount:v.loggingMetaData.playerImplementationInstanceCountRef.current,playerInstanceKey:v.loggingMetaData.instanceKey,playerSuborigin:v.loggingMetaData.coreVideoPlayerMetaData.subOrigin,playerVersion:z,videoElement:B,videoFBID:A});d={config:D,customParsers:g(),customRepresentationParsers:h({ozConfig:D}),customSegmentTimelineParser:D.getBool("enable_predictive_dash",!1)?new(b("oz-player/parsers/OzPredictedSegmentTimelineParser"))():void 0,debugCreateInitiator:b("gkx")("1435909")?[].concat(d,["proceedWithOzPlayerCreation"]).join(":"):null,dimensions:{height:M.height,width:M.width},drmManagerModule:N,drmProviders:E,getShouldIncludeCredentials:D.getBool("use_oz_credentials_provider",!1)?l:null,initialPlaybackPositionForDynamicMpd:i(D,(A=v.initialDesiredLatencyMs)!=null?A:0),initialRepresentationIDs:(d=v.initialRepresentationIds)!=null?d:[],liveheadFallBehindBlockMargin:j(D,(M=v.initialDesiredLatencyMs)!=null?M:0),liveheadFallBehindBlockThreshold:k(D,(N=v.initialDesiredLatencyMs)!=null?N:0,(E=v.initialLatencyToleranceMs)!=null?E:0),loggerConfig:{isOzDevConsoleEnabled:b("gkx")("722076"),observedOperationLoggers:r&&e&&e.shouldInitialize()?r.getObservedOperationLoggers():[],perfLoggerProviders:z},mpdUrl:F,networkRequestStreamHandlers:[new(b("OzVideoLiveTraceNetworkRequestStreamHandler"))(function(a,b){var c=s();c!=null&&c.handleHeaders(a,b)})],prefetchCache:D.getBool("use_prefetch_cache",!1)?new(b("OzDashPrefetchCache"))():null,rawMpdXml:G,seekHandler:b("gkx")("1482680")?function(a){var b=B.currentTime;w.dispatch({payload:{seekSourcePosition:b},type:"implementation_seek_requested"});B.currentTime=a}:null,startTimeStamp:D.getBool("fix_start_timestamp",!1)?v.startTimestamp:0,videoNodeOrQuickStarter:(A=r)!=null?A:B,videoPlaybackRestrictions:b("getOzPlaybackRestrictions")(H,{keepLowestMosAboveUpperThresold:D.getBool("keep_lowest_mos_above_upper_thresold",!1),mosLowerThreshold:D.getNumber("mos_lower_threshold",0),mosUpperThreshold:D.getNumber("mos_upper_threshold",0)})};var O=new c(d);y.current=O;M=v.loggingMetaData.playerImplementationInstanceCountRef;M.current++;O.onError(function(a){u(a,"oz_player_error")});O.setupPlayer();O.addListener("switchVideoRepresentation",function(){var a=q();w.dispatch({payload:{targetVideoQuality:(a=a==null?void 0:a.getCurrentTargetVideoQuality())!=null?a:""},type:"representation_changed"})});O.addListener("streamInterruptAt",function(){w.dispatch({type:"stream_interrupted"})});O.addListener("streamResumedAt",function(){w.dispatch({type:"stream_resumed"})});O.addListener("streamEnd",function(){w.dispatch({type:"stream_ended"})});f&&f.handleOzPlayerChanged(O);m(B,a,D,w,x);if(D.getBool("emit_cea_608_availability",!1)){var P=function(){var a=q(),b=p();a={inbandCaptionsAutogeneratedFromManifest:a!=null?a==null?void 0:a.getInbandCaptionsAutogeneratedFromManifest():!1,inbandCaptionsExpectedFromManifest:a!=null?a.getInbandCaptionsExpectedFromManifest():!1,inbandCaptionsExpectedFromProps:b==null?void 0:b.inbandCaptionsExpectedFromProps,sideLoadCaptionsExpectedFromProps:b==null?void 0:b.sideLoadCaptionsExpectedFromProps,sideLoadCaptionsUrlFromProps:b==null?void 0:b.sideLoadCaptionsUrlFromProps};b=w.getCurrentState();b=b.controlledState;(a.inbandCaptionsExpectedFromManifest!==b.captionsLoaded||a.inbandCaptionsAutogeneratedFromManifest!==b.inbandCaptionsAutogenerated)&&t(a)};N=function(a,b){a=a.getCustomField("timescale")||0;w.dispatch({payload:{timescale:a,videoBytes:b},type:"cea608_bytes_received"})};var Q=function(){var a=q();a=a==null?void 0:a.getVideoRepresentations();if(a!=null&&a.length>0){a=a[0].getTimeRanges();if(a!=null&&a.length>0){var c=a[0].startTime;a=Math.max(a[a.length-1].endTime-D.getNumber("live_rewind_seek_to_live_delta",8),c);w.dispatch({payload:{seekableRanges:new(b("TimeRanges"))([{endTime:a,startTime:c}])},type:"seekable_ranges_changed"})}}},R=function(){var a=O.getMpd().getCustomField("loapStreamType"),b=s();typeof a==="number"&&b!=null&&b.setStreamType(a)};O.getMpd().addListener("updated",function(){Q(),P(),R()});D.getBool("parse_cea_608",!1)&&O.updatePlayerRunTimeConfig({videoStreamDataHandler:N})}I.isPredictiveDash()&&D.setContext("latency_level","predictive");E=p();t({inbandCaptionsAutogeneratedFromManifest:I.getInbandCaptionsAutogeneratedFromManifest(),inbandCaptionsExpectedFromManifest:I.getInbandCaptionsExpectedFromManifest(),inbandCaptionsExpectedFromProps:E==null?void 0:E.inbandCaptionsExpectedFromProps,sideLoadCaptionsExpectedFromProps:E==null?void 0:E.sideLoadCaptionsExpectedFromProps,sideLoadCaptionsUrlFromProps:E==null?void 0:E.sideLoadCaptionsUrlFromProps})}e.exports={proceedWithOzPlayerCreation:a}}),null);