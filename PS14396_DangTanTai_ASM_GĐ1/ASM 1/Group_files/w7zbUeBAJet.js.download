if (self.CavalryLogger) { CavalryLogger.start_js(["W3Wx0"]); }

__d("VideoPlayerOzImplementationEnginePartsImplUtils",["HTML5OzDrmHelper","gkx","oz-player/strategies/OzBufferingDetector"],(function(a,b,c,d,e,f){"use strict";var g=/(livestream-)?lookaside\.(facebook|workplace)\.com$/;function a(a){return g.test(a.getDomain())}function c(a,c,d,e,f){if(f.current!=null)return;a=new(b("oz-player/strategies/OzBufferingDetector"))(a,d,function(){var a=e.getCurrentState();a=a.controlledState;return a.streamEnded?c.getDuration():Infinity});f.current=a;d=function(){if(b("gkx")("1235655"))return;e.dispatch({type:"buffering_begin_requested"})};f=function(){e.dispatch({type:"buffering_end_requested"})};a.addListener("enter_buffering",d);a.addListener("leave_buffering",f)}function d(a){var c=a.graphQLVideoDRMInfo;a=a.videoFBID;var d=c?b("HTML5OzDrmHelper").OzDrmManagerModule:null,e=[];c&&a!=null&&e.push(new(b("HTML5OzDrmHelper").OzWidevineDrmProviderModule)(a,c.graphApiVideoLicenseUri,c.videoLicenseUriMap,null,null));return{drmManagerModule:d,drmProviders:e}}function f(a){var b=a.VideoPlayerShakaPerformanceLoggerClass,c=a.getBandwidthEstimate,d=a.playbackIsLiveStreaming,e=a.playerInstanceCount,f=a.playerInstanceKey,g=a.playerSuborigin,h=a.playerVersion,i=a.videoElement;a=a.videoFBID;if(!b||!b.shouldInitialize())return[];d={accessToken:null,getBandwidthEstimate:c,isLive:d,isServableViaFbms:!1,playerInstanceCount:e,playerOrigin:null,playerSuborigin:g,playerVersion:h,representationId:null,uniqueID:f,video:i,videoID:(c=a)!=null?c:""};return[new b(d)]}function h(a,b){return b>0?b/1e3*-1:a.getNumber("live_initial_playback_position",0)}function i(a,b,c){return b>0&&c>0?(b+c)/1e3:a.getNumber("livehead_fall_behind_block_threshold",0)}function j(a,b){return b>0?b/2/1e3:a.getNumber("live_time_range_block_margin",0)}e.exports={calculateInitialPlaybackPositionForDynamicMpd:h,calculateLiveheadFallBehindBlockMargin:j,calculateLiveheadFallBehindBlockThreshold:i,checkShouldIncludeCredentials:a,createOzBufferingDetector:c,createOzDrmModules:d,createOzPerfLoggerProviders:f}}),null);